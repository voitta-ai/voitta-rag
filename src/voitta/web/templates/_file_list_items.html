{% if items %}
{% for item in items %}
{% set item_index_status = index_statuses.get(item.path, 'none') if item.is_dir else (file_index_statuses.get(item.path, {}).get('status', 'none')) %}
{% set file_chunk_count = file_index_statuses.get(item.path, {}).get('chunk_count', 0) if not item.is_dir else 0 %}
{% set stats = folder_stats.get(item.path, {}) if item.is_dir else {} %}
{% set item_search_active = folder_search_states.get(item.path, false) if item.is_dir else false %}
{% set item_sync_type = folder_sync_types.get(item.path) or current_sync_type %}
{% set item_git_private = folder_git_private.get(item.path, current_git_private) if item_sync_type == 'github' else false %}
<div class="file-item {% if item.is_dir %}folder{% else %}file{% endif %}"
     data-path="{{ item.path }}"
     data-index-status="{{ item_index_status }}"
     data-search-active="{{ 'true' if item_search_active else 'false' }}"
     onclick="selectItem(this, '{{ item.path }}', {{ 'true' if item.is_dir else 'false' }})">
    <div class="col-name">
        {% if item.is_dir %}
        <svg viewBox="0 0 24 24" fill="currentColor" class="file-icon folder-icon">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
        {% else %}
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="file-icon">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
        </svg>
        {% endif %}
        <span class="file-name-text">{{ item.name }}</span>
    </div>
    <div class="col-sync-icon">
        {% if item_sync_type == 'sharepoint' %}
        <svg viewBox="0 0 24 24" class="sync-source-icon" title="SharePoint">
            <circle cx="12" cy="8" r="5" fill="#038387" opacity="0.9"/>
            <circle cx="7" cy="15" r="4.5" fill="#0364b8" opacity="0.9"/>
            <circle cx="16" cy="16" r="4" fill="#1490df" opacity="0.9"/>
        </svg>
        {% elif item_sync_type == 'google_drive' %}
        <svg viewBox="0 0 24 24" class="sync-source-icon" title="Google Drive">
            <path d="M8.5 2L1 15h6.5L15 2H8.5z" fill="#0da960"/>
            <path d="M15 2l-7.5 13H23L15 2z" fill="#ffd04b"/>
            <path d="M1 15l3.5 6h15l3.5-6H1z" fill="#4286f4"/>
        </svg>
        {% elif item_sync_type == 'github' %}
        <svg viewBox="-2 -2 28 28" fill="#8b949e" class="sync-source-icon" title="Git{% if item_git_private %} (private){% else %} (public){% endif %}">
            <circle cx="12" cy="12" r="13" fill="none" stroke="{{ '#e53935' if item_git_private else '#43a047' }}" stroke-width="1" stroke-dasharray="3 2"/>
            <path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.463-1.11-1.463-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.115 2.504.337 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"/>
        </svg>
        {% elif item_sync_type == 'azure_devops' %}
        <svg viewBox="0 0 24 24" class="sync-source-icon" title="Azure DevOps">
            <path d="M22 5.5v13l-5.5 3.5-8-2.83V22L3 17.5l13.5 1V5l-8.5-3v2.5L3 6.5V17l5.5-5V2L22 5.5z" fill="#0078d7"/>
        </svg>
        {% elif item_sync_type == 'jira' %}
        <svg viewBox="0 0 24 24" class="sync-source-icon" title="Jira">
            <path d="M11.571 11.513H0a5.218 5.218 0 0 0 5.232 5.215h2.13v2.057A5.215 5.215 0 0 0 12.575 24V12.518a1.005 1.005 0 0 0-1.005-1.005zm5.723-5.756H5.736a5.215 5.215 0 0 0 5.215 5.214h2.129v2.058a5.218 5.218 0 0 0 5.215 5.214V6.758a1.001 1.001 0 0 0-1.001-1.001zM23.013 0H11.455a5.215 5.215 0 0 0 5.215 5.215h2.129v2.057A5.215 5.215 0 0 0 24.013 12.483V1.005A1.005 1.005 0 0 0 23.013 0z" fill="#2684FF"/>
        </svg>
        {% elif item_sync_type == 'confluence' %}
        <svg viewBox="0 0 24 24" class="sync-source-icon" title="Confluence">
            <path d="M.87 18.257c-.248-.382-.53-.875-.763-1.245a.764.764 0 0 1 .255-1.04l4.965-3.07a.764.764 0 0 1 1.058.26c.199.332.49.77.886 1.27 1.427 1.784 2.914 1.49 5.594.144l5.209-2.621a.764.764 0 0 1 1.02.35l2.044 4.257a.764.764 0 0 1-.325 1.017c-.142.073-3.54 1.81-7.168 3.09-5.013 1.77-10.637.98-12.775-2.412zM23.131 5.743c.248.382.53.875.762 1.245a.764.764 0 0 1-.255 1.04l-4.965 3.07a.764.764 0 0 1-1.058-.26 11.727 11.727 0 0 0-.886-1.27c-1.427-1.784-2.914-1.49-5.594-.144L5.926 12.045a.764.764 0 0 1-1.02-.35L2.862 7.438a.764.764 0 0 1 .325-1.017c.142-.073 3.54-1.81 7.168-3.09 5.013-1.77 10.637-.98 12.775 2.412z" fill="#1868DB"/>
        </svg>
        {% elif item_sync_type == 'box' %}
        <svg viewBox="0 0 24 24" class="sync-source-icon" title="Box">
            <path d="M3 7l9-5 9 5-9 5-9-5z" fill="#0061D5" opacity="0.5"/>
            <path d="M3 7v10l9 5V12L3 7z" fill="#0061D5" opacity="0.75"/>
            <path d="M21 7v10l-9 5V12l9-5z" fill="#0061D5"/>
        </svg>
        {% endif %}
    </div>
    <div class="col-search">
        {% if item.is_dir %}
        <label class="inline-toggle" onclick="event.stopPropagation()">
            <input type="checkbox"
                   {% if item_search_active %}checked{% endif %}
                   onchange="toggleSearchActiveInline(this, '{{ item.path }}')">
            <span class="inline-toggle-slider"></span>
        </label>
        {% endif %}
    </div>
    <div class="col-size">{% if not item.is_dir %}{{ item.size | filesizeformat }}{% elif stats and stats.get('total_size', 0) > 0 %}{{ stats.get('total_size', 0) | filesizeformat }}{% else %}—{% endif %}</div>
    <div class="col-status">
        <span class="index-status-tag status-{{ item_index_status or 'none' }}" title="{% if item.is_dir and stats %}{{ stats.get('indexed_files', 0)|compact }} files indexed, {{ stats.get('total_chunks', 0)|compact }} chunks{% elif file_chunk_count %}{{ file_chunk_count|compact }} chunks{% else %}{{ item_index_status or 'none' }}{% endif %}">
            {% if item.is_dir %}
                {% if item_index_status == 'indexed' or item_index_status == 'disabled' %}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="status-icon-sm">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                {% elif item_index_status == 'indexing' %}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="status-icon-sm spin">
                    <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"></path>
                </svg>
                {% elif item_index_status == 'pending' %}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="status-icon-sm">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                {% elif item_index_status == 'error' %}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="status-icon-sm">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
                {% endif %}
                {% if stats and (stats.get('indexed_files', 0) > 0 or stats.get('total_chunks', 0) > 0) %}
                <span class="folder-stats">{{ stats.get('indexed_files', 0)|compact }}{% if stats.get('total_chunks', 0) > 0 %} · {{ stats.get('total_chunks', 0)|compact }}{% endif %}</span>
                {% elif item_index_status != 'none' %}
                {{ item_index_status|capitalize }}
                {% else %}
                —
                {% endif %}
            {% else %}
                {% if item_index_status == 'indexed' %}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="status-icon-sm">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                {{ file_chunk_count|compact }}
                {% else %}
                —
                {% endif %}
            {% endif %}
        </span>
    </div>
</div>
{% endfor %}
{% else %}
<div class="empty-state">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="empty-icon">
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
    </svg>
    <p>This folder is empty</p>
</div>
{% endif %}
