services:
  qdrant:
    image: qdrant/qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - ${VOITTA_ROOT_PATH}/qdrant:/qdrant/storage

  voitta-rag:
    build: .
    ports:
      - "${DOCKER_PORT:-58000}:8000"
    env_file: .env
    environment:
      - QDRANT_HOST=qdrant
      - VOITTA_ROOT_PATH=/data/fs
      - VOITTA_DB_PATH=/data/voitta.db
      - HF_HOME=/root/.cache/huggingface
    volumes:
      - ${VOITTA_ROOT_PATH}:/data
      - ./users.txt:/app/users.txt:ro
      - ${SSH_KEY_DIR:-~/.ssh}:/root/.ssh:ro
      - ${MODEL_CACHE_DIR:-~/.cache/huggingface}:/root/.cache/huggingface
    depends_on:
      - qdrant
